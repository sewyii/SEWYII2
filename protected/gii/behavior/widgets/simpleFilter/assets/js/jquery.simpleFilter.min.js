;(function($){$.fn.simpleFilter=function(options){var n=this;if(n.length<1){return n;}
options=(options)?options:{};$.simpleFilterData.instances[n.attr('id')]={input:this,itemFocus:0};$.simpleFilterData.instances.count++;var self=$.simpleFilterData.instances[n.attr('id')];var auditOptions=function(options){if(!options.data||!options.data.length||typeof(options.data)!="object"){options.data=$.simpleFilterData.defaults.data;}
if(!options.maxListEntries||typeof options.maxListEntries!='number'||options.maxListEntries<0){options.maxListEntries=$.simpleFilterData.defaults.maxListEntries;}
if(typeof(options.caseSensitive)!='boolean'){options.caseSensitive=$.simpleFilterData.defaults.caseSensitive;}
if(typeof(options.useQuicksilver)!='boolean'){options.useQuicksilver=$.simpleFilterData.defaults.useQuicksilver;}
if(typeof(options.showAll)!='boolean'){options.showAll=$.simpleFilterData.defaults.showAll;}
if(typeof(options.position)!='number'||options.position<0||options.position>=$.simpleFilterData.positions.length){options.position=$.simpleFilterData.defaults.position;}
if(typeof(options.sortBy)!='number'||options.sortBy<0||options.sortBy>=$.simpleFilterData.sortBy.length){options.sortBy=$.simpleFilterData.defaults.sortBy;}
if(typeof(options.waitTime)!='number'||typeof options.waitTime!='number'||options.waitTime<0){options.waitTime=$.simpleFilterData.defaults.waitTime;}
return options;}
var repositionList=function(){var l=$(self.list);if(!n||n.length<1){return;}
var pos=n.offset();var t=pos.top+n.height()+5;var placeAbove=false;var vh=(window.innerHeight)?window.innerHeight:$(window).height();var st=(document.documentElement.scrollTop)?document.documentElement.scrollTop:document.body.scrollTop;if($.simpleFilterData.positions[self.options.position]=='above'||($.simpleFilterData.positions[self.options.position]!='below'&&((t-st)+l.height())>vh&&((pos.top-st)-l.height())>0)){placeAbove=true;if($.browser&&$.browser.msie&&$.browser.version<7){var b=$(document).height()-(pos.top+2);}else{var b=vh-(pos.top+1);}}
l.css({left:pos.left,width:n.width()+2});if(placeAbove){l.css({'bottom':b+'px','top':'auto'});}else{l.css({'bottom':'auto','top':t});}}
var handleKeyControl=function(key){if(key==38){self.itemFocus--;if(self.itemFocus<1){self.itemFocus=$(self.list).children('li:visible').length;}}else if(key==40){self.itemFocus++;if(self.itemFocus>$(self.list).children('li:visible').length){self.itemFocus=1;}}else if(key==13){if(self.itemFocus>0){var item=$(self.list).children('li:visible:eq('+(self.itemFocus-1)+')');handleSelect(item.get(0));return true;}}
$(self.list).children('li').removeClass('activeFilterOption').attr('aria-selected','false');$(self.list).children('li:visible:eq('+(self.itemFocus-1)+')').addClass('activeFilterOption').attr('aria-selected','true');}
var score=function(text,input){for(var i=0;i<input.length;++i){if(input.substr(i,1)!=text.substr(i,1)){return 0;}}
return(input.length/text.length);}
function showItem(itemNode){l.append(itemNode);$(itemNode).show().attr('aria-hidden','false');}
function hideItem(itemNode){itemNode.hide().attr('aria-hidden','true');}
function showList(){l.show().attr('aria-hidden','false');}
function hideList(){l.add(l.find('li')).hide().attr('aria-hidden','true');self.itemFocus=0;}
function showAll(){showList();$.each(self.cache,function(){showItem(this[1]);});repositionList();}
function handleInput(){if(self.waitHandle===null){self.waitHandle=setTimeout(function(){self.waitHandle=null;doFilter();},self.options.waitTime);}}
function handleSelect(itemNode){if(itemNode){self.input.val(itemNode.innerHTML).trigger('input.simpleFilter',[itemNode.innerHTML]);hideList();self.input.focus();}}
if($.simpleFilterData.instances.count==1){$(window).bind('resize.simpleFilter',function(){$.each($.simpleFilterData.instances,function(key){if(key!='count'){repositionList();}});});}
self.options=auditOptions($.extend({},$.simpleFilterData.defaults,options));self.input.attr('autocomplete','off');self.cache=[];if(self.options.data.length>0){$.each(self.options.data,function(i){self.cache.push([""+this,$('<li role="option" datatype="string">'+this+'</li>')]);});}else{return n;}
var pos=n.offset();self.list=$('body').append('<ul id="'+n.attr('id')+'_simpleFilterInput" class="filterList" style="display: none;" role="listbox" aria-hidden="true" aria-live="assertive" aria-relevant="additions removals"></ul>').find('ul#'+n.attr('id')+'_simpleFilterInput').css({position:'absolute',left:pos.left,width:n.width()+2,zIndex:990}).get(0);var l=$(self.list);self.input.attr('aria-controls',n.attr('id')+'_simpleFilterInput');$.each(self.cache,function(i){$(this[1]).hide().appendTo(l).click(function(e){handleSelect(this);}).hover(function(){$(this).addClass('activeFilterOption');},function(){$(this).removeClass('activeFilterOption');});});function doFilter(){self.waitHandle=null;var input=$.trim(n.val());if(!self.options.caseSensitive){input=input.toLowerCase();}
if(input.length<1){if(!self.options.showAll){hideList();}}else{var scores=[];$.each(self.cache,function(i){var w=this[0];if(!self.options.caseSensitive){w=w.toLowerCase();}
if(self.options.useQuicksilver){var s=$.score(w,input);}else{var s=score(w,input);}
if(s>0){scores.push([s,i,this]);}else{hideItem(this[1]);}});if($.simpleFilterData.sortBy[self.options.sortBy]!='none'&&scores.length>0){scores.sort(function(a,b){switch($.simpleFilterData.sortBy[self.options.sortBy]){case'score':return b[0]-a[0];case'alpha':if(a[2][0]>b[2][0]){return 1;}else
if(b[2][0]>a[2][0]){return-1;}else
{return 0;}
default:return 0;}});}
if($.isFunction(self.options.postFilter)){self.options.postFilter.apply(self.input,[input,scores]);}
if(scores.length>0){showList();if(self.options.maxListEntries&&self.options.maxListEntries>0){scores=scores.slice(0,self.options.maxListEntries);var unused=scores.slice(self.options.maxListEntries);$.each(unused,function(){hideItem(this[2][1]);});}
$.each(scores,function(){showItem(this[2][1]);});if(scores[0][2].toString().toLowerCase()==n.val().toLowerCase()){hideList();return;}
repositionList();}else{hideList();return;}}}
self.waitHandle=null;n.bind('keyup.simpleFilter',function(e){if($.trim(self.input.val()).length<1&&self.options.showAll&&l.is(':hidden')){if(e.keyCode==40||e.which==40||e.keyCode==38||e.which==38){showAll();}}
if(e.keyCode==40||e.which==40){handleKeyControl(40);if(l.is(':hidden')){handleInput();}}else if(e.keyCode==38||e.which==38){handleKeyControl(38);if(l.is(':hidden')){handleInput();}}else if(e.keyCode==13||e.which==13){if(handleKeyControl(13)){e.preventDefault();}}else if(e.keyCode==27||e.which==27){hideList();}else{handleInput();}});n.bind('blur.simpleFilter',function(){setTimeout(function(){if(l.is(':visible')){hideList();}},150);});return n;};$.fn.removeSimpleFilter=function(){var n=this;if(n.length<1){return n;}
n.unbind('.simpleFilter');if($.simpleFilterData.instances[n.attr('id')]){$($.simpleFilterData.instances[n.attr('id')].list).remove();$.simpleFilterData.instances[n.attr('id')]=null;$.simpleFilterData.instances.count--;}
if($.simpleFilterData.instances.count<1){$(window).unbind('resize.simpleFilter');}
return n;}
$.simpleFilterData={instances:{count:0},SORT_SCORE:0,SORT_ALPHA:1,SORT_NONE:2,POSITION_VARIABLE:0,POSITION_ABOVE:1,POSITION_BELOW:2,sortBy:['score','alpha','none'],positions:['variable','above','below'],defaults:{data:[],maxListEntries:null,caseSensitive:false,useQuicksilver:true,showAll:false,position:0,sortBy:0,waitTime:150,postFilter:null}};})(jQuery);